<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Mauri Services</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f8f9fa;
            color: #333;
        }
        
        .admin-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-nav {
            background: #2c5aa0;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .admin-nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .admin-nav a:hover, .admin-nav a.active {
            background: rgba(255,255,255,0.2);
        }
        
        .content {
            padding: 2rem;
        }
        
        .section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #2c5aa0;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #2c5aa0;
            outline: none;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.25rem;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #2c5aa0;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .setting-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid #2c5aa0;
            margin-bottom: 1rem;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            border-bottom-color: #2c5aa0;
            color: #2c5aa0;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .price-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .danger-zone {
            background: #fff5f5;
            border: 2px solid #dc3545;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 2rem;
        }
        
        .danger-zone h3 {
            color: #dc3545;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .admin-nav {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .admin-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                padding: 0.8rem 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <h1>ğŸš€ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Mauri Services</h1>
        <div>
            <span id="adminName">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø§Ù„Ù…Ø¯ÙŠØ±</span>
            <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>
    
    <nav class="admin-nav">
        <a href="admin-dashboard.html">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
        <a href="admin-visitors.html">ğŸ‘¥ Ø§Ù„Ø²ÙˆØ§Ø±</a>
        <a href="admin-orders.html">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
        <a href="admin-messages.html">ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</a>
        <a href="admin-agents.html">ğŸ‘¥ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</a>
        <a href="admin-users.html">ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</a>
        <a href="admin-settings.html" class="active">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
    </nav>
    
    <div class="content">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="openTab('general')">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</button>
            <button class="tab-btn" onclick="openTab('pricing')">Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª</button>
            <button class="tab-btn" onclick="openTab('notifications')">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
            <button class="tab-btn" onclick="openTab('backup')">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
        <div id="general" class="tab-content active">
            <div class="settings-grid">
                <div class="section">
                    <h2>ğŸŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
                    
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                        <input type="text" id="siteName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
                    </div>
                    
                    <div class="form-group">
                        <label>ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                        <textarea id="siteDescription" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ù…ÙˆÙ‚Ø¹"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="siteEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" id="phoneNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                    </div>
                    
                    <button class="btn btn-primary" onclick="saveGeneralSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                </div>
                
                <div class="section">
                    <h2>ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h2>
                    
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
                        <input type="tel" id="whatsappNumber" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ</label>
                        <input type="url" id="facebookUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…</label>
                        <input type="url" id="instagramUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                        <textarea id="siteAddress" rows="2" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" onclick="saveContactSettings()">ğŸ’¾ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</button>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª -->
        <div id="pricing" class="tab-content">
            <div class="section">
                <h2>ğŸ’° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h2>
                
                <div class="price-grid">
                    <div class="price-item">
                        <div class="form-group">
                            <label>ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª (MRU)</label>
                            <input type="number" id="priceShopping" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                        </div>
                    </div>
                    
                    <div class="price-item">
                        <div class="form-group">
                            <label>Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (MRU)</label>
                            <input type="number" id="priceDocuments" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                        </div>
                    </div>
                    
                    <div class="price-item">
                        <div class="form-group">
                            <label>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (MRU)</label>
                            <input type="number" id="priceResearch" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="savePricingSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
        <div id="notifications" class="tab-content">
            <div class="section">
                <h2>ğŸ”” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
                
                <div class="setting-card">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyNewOrders"> 
                            Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyNewMessages"> 
                            Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="notifyNewAgents"> 
                            Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</label>
                        <input type="email" id="notificationEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">
                    </div>
                    
                    <button class="btn btn-primary" onclick="saveNotificationSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
        <div id="backup" class="tab-content">
            <div class="section">
                <h2>ğŸ’¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                
                <div class="setting-card">
                    <h3>ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    <p>Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    <button class="btn btn-primary" onclick="exportAllData()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button class="btn btn-warning" onclick="exportOrdersData()">ğŸ“¦ ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙ‚Ø·</button>
                </div>
                
                <div class="danger-zone">
                    <h3>âš ï¸ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</h3>
                    <p>Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§</p>
                    
                    <div class="form-group">
                        <label>Ø§ÙƒØªØ¨ "DELETE" Ù„Ù„ØªØ£ÙƒÙŠØ¯</label>
                        <input type="text" id="deleteConfirm" placeholder="Ø§ÙƒØªØ¨ DELETE Ù‡Ù†Ø§">
                    </div>
                    
                    <button class="btn btn-danger" onclick="clearAllData()" id="deleteBtn" disabled>ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <button class="btn btn-danger" onclick="resetSettings()" id="resetBtn" disabled>ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC3qL5dzdOvIv7raaEd3xWOOraCiRks0h0",
            authDomain: "mauri-services.firebaseapp.com",
            projectId: "mauri-services",
            storageBucket: "mauri-services.firebasestorage.app",
            messagingSenderId: "324986363643",
            appId: "1:324986363643:web:803453b8ff2681b51d1a5e"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        auth.onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = 'admin-login.html';
            } else {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                db.collection('users').doc(user.uid).get().then((doc) => {
                    if (doc.exists && doc.data().role === 'admin') {
                        document.getElementById('adminName').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${doc.data().name}`;
                        initSettingsPage();
                    } else {
                        alert('âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
                        logout();
                    }
                });
            }
        });
        
        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'admin-login.html';
            });
        }
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹ Firebase
        class SettingsManager {
            constructor() {
                this.settings = {};
                this.init();
            }
            
            async init() {
                await this.loadSettings();
                this.setupEventListeners();
            }
            
            async loadSettings() {
                try {
                    const settingsDoc = await db.collection('settings').doc('general').get();
                    
                    if (settingsDoc.exists) {
                        this.settings = settingsDoc.data();
                        this.populateForm();
                    } else {
                        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                        this.settings = this.getDefaultSettings();
                        await this.saveSettings();
                    }
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                }
            }
            
            getDefaultSettings() {
                return {
                    siteName: 'Mauri Services',
                    siteDescription: 'Ù…Ù†ØµØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© ÙÙŠ Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§',
                    siteEmail: 'mauriservices33@gmail.com',
                    phoneNumber: '22244869780',
                    whatsappNumber: '22244869780',
                    facebookUrl: '',
                    instagramUrl: '',
                    siteAddress: 'Ù†ÙˆØ§ÙƒØ´ÙˆØ·ØŒ Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§',
                    
                    pricing: {
                        shopping: 100,
                        documents: 200,
                        research: 200
                    },
                    
                    notifications: {
                        newOrders: true,
                        newMessages: true,
                        newAgents: true,
                        notificationEmail: 'mauriservices33@gmail.com'
                    },
                    
                    updatedAt: new Date()
                };
            }
            
            populateForm() {
                // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                document.getElementById('siteName').value = this.settings.siteName || '';
                document.getElementById('siteDescription').value = this.settings.siteDescription || '';
                document.getElementById('siteEmail').value = this.settings.siteEmail || '';
                document.getElementById('phoneNumber').value = this.settings.phoneNumber || '';
                
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„
                document.getElementById('whatsappNumber').value = this.settings.whatsappNumber || '';
                document.getElementById('facebookUrl').value = this.settings.facebookUrl || '';
                document.getElementById('instagramUrl').value = this.settings.instagramUrl || '';
                document.getElementById('siteAddress').value = this.settings.siteAddress || '';
                
                // Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
                document.getElementById('priceShopping').value = this.settings.pricing?.shopping || '';
                document.getElementById('priceDocuments').value = this.settings.pricing?.documents || '';
                document.getElementById('priceResearch').value = this.settings.pricing?.research || '';
                
                // Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                document.getElementById('notifyNewOrders').checked = this.settings.notifications?.newOrders || false;
                document.getElementById('notifyNewMessages').checked = this.settings.notifications?.newMessages || false;
                document.getElementById('notifyNewAgents').checked = this.settings.notifications?.newAgents || false;
                document.getElementById('notificationEmail').value = this.settings.notifications?.notificationEmail || '';
            }
            
            async saveSettings() {
                try {
                    await db.collection('settings').doc('general').set({
                        ...this.settings,
                        updatedAt: new Date()
                    });
                    
                    return true;
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                    return false;
                }
            }
            
            setupEventListeners() {
                // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
                document.getElementById('deleteConfirm').addEventListener('input', function() {
                    const deleteBtn = document.getElementById('deleteBtn');
                    const resetBtn = document.getElementById('resetBtn');
                    const isConfirmed = this.value === 'DELETE';
                    
                    deleteBtn.disabled = !isConfirmed;
                    resetBtn.disabled = !isConfirmed;
                });
            }
        }
        
        // ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø©
        function openTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ø¥Ù„ØºØ§Ø¡ ØªÙ†Ø´ÙŠØ· ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        async function saveGeneralSettings() {
            settingsManager.settings.siteName = document.getElementById('siteName').value;
            settingsManager.settings.siteDescription = document.getElementById('siteDescription').value;
            settingsManager.settings.siteEmail = document.getElementById('siteEmail').value;
            settingsManager.settings.phoneNumber = document.getElementById('phoneNumber').value;
            
            const success = await settingsManager.saveSettings();
            if (success) {
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            }
        }
        
        async function saveContactSettings() {
            settingsManager.settings.whatsappNumber = document.getElementById('whatsappNumber').value;
            settingsManager.settings.facebookUrl = document.getElementById('facebookUrl').value;
            settingsManager.settings.instagramUrl = document.getElementById('instagramUrl').value;
            settingsManager.settings.siteAddress = document.getElementById('siteAddress').value;
            
            const success = await settingsManager.saveSettings();
            if (success) {
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            }
        }
        
        async function savePricingSettings() {
            if (!settingsManager.settings.pricing) {
                settingsManager.settings.pricing = {};
            }
            
            settingsManager.settings.pricing.shopping = parseInt(document.getElementById('priceShopping').value) || 0;
            settingsManager.settings.pricing.documents = parseInt(document.getElementById('priceDocuments').value) || 0;
            settingsManager.settings.pricing.research = parseInt(document.getElementById('priceResearch').value) || 0;
            
            const success = await settingsManager.saveSettings();
            if (success) {
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±');
            }
        }
        
        async function saveNotificationSettings() {
            if (!settingsManager.settings.notifications) {
                settingsManager.settings.notifications = {};
            }
            
            settingsManager.settings.notifications.newOrders = document.getElementById('notifyNewOrders').checked;
            settingsManager.settings.notifications.newMessages = document.getElementById('notifyNewMessages').checked;
            settingsManager.settings.notifications.newAgents = document.getElementById('notifyNewAgents').checked;
            settingsManager.settings.notifications.notificationEmail = document.getElementById('notificationEmail').value;
            
            const success = await settingsManager.saveSettings();
            if (success) {
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            }
        }
        
        async function exportAllData() {
            try {
                // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const [ordersSnapshot, messagesSnapshot, agentsSnapshot, visitorsSnapshot] = await Promise.all([
                    db.collection('orders').get(),
                    db.collection('messages').get(),
                    db.collection('agent_applications').get(),
                    db.collection('visitors').get()
                ]);
                
                const data = {
                    orders: ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    messages: messagesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    agents: agentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    visitors: visitorsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    exportDate: new Date().toLocaleString('ar-SA'),
                    totalRecords: ordersSnapshot.size + messagesSnapshot.size + agentsSnapshot.size + visitorsSnapshot.size
                };
                
                downloadJSON(data, `backup_mauri-services_${new Date().toISOString().split('T')[0]}.json`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }
        
        async function exportOrdersData() {
            try {
                const ordersSnapshot = await db.collection('orders').get();
                const data = {
                    orders: ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    exportDate: new Date().toLocaleString('ar-SA'),
                    totalOrders: ordersSnapshot.size
                };
                
                downloadJSON(data, `orders_mauri-services_${new Date().toISOString().split('T')[0]}.json`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª');
            }
        }
        
        function downloadJSON(data, filename) {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = filename;
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${filename} Ø¨Ù†Ø¬Ø§Ø­`);
        }
        
        async function clearAllData() {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
                try {
                    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ù†Ø§
                    alert('ğŸš§ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            }
        }
        
        async function resetSettings() {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŸ Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª!')) {
                try {
                    settingsManager.settings = settingsManager.getDefaultSettings();
                    await settingsManager.saveSettings();
                    settingsManager.populateForm();
                    
                    alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†:', error);
                    alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†');
                }
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…
        let settingsManager;
        function initSettingsPage() {
            settingsManager = new SettingsManager();
        }
    </script>
</body>
</html>